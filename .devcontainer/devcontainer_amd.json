{
    "name": "MSCCL++ Dev Container",
    "build": {
        "dockerfile": "Dockerfile",
        "args": {
            "BASE_IMAGE": "ghcr.io/microsoft/mscclpp/mscclpp:base-dev-rocm6.2",
            "USERNAME": "devuser",
            "SSH_PORT": "22345"
        }
    },
    "remoteUser": "devuser",
    "containerEnv": {
        "LC_ALL": "C",
        "LANG": "C",
        "LANGUAGE": "C"
    },
    "customizations": {
        "vscode": {
            "extensions": [
                // Python
                "ms-python.python",
                "ms-python.vscode-pylance",
                // C++
                "ms-vscode.cpptools",
                "ms-vscode.cmake-tools"
            ],
            "settings": {
                "terminal.integrated.defaultProfile.linux": "bash",
                "C_Cpp.default.includePath": [
                    "${workspaceFolder}/**",
                    "/opt/rocm/include",
                    "/usr/include"
                ],
                "C_Cpp.default.compilerPath": "/usr/bin/gcc",
                "C_Cpp.default.cStandard": "c17",
                "C_Cpp.default.cppStandard": "c++17",
                "C_Cpp.default.intelliSenseMode": "linux-gcc-x64"
            }
        }
    },
    "privileged": true,
    "runArgs": [
        "--cap-add=SYS_PTRACE",
        "--net=host",
        "--ipc=host",
        "--ulimit=memlock=-1:-1",
        "--security-opt=seccomp=unconfined",
        "--group-add=video",
        "--device=/dev/kfd",
        "--device=/dev/dri"
    ],
    "workspaceFolder": "/home/devuser/mscclpp",
    "workspaceMount": "source=${localWorkspaceFolder},target=/home/devuser/mscclpp,type=bind,consistency=cached",
    "postStartCommand": "sudo service ssh start",
    "postCreateCommand": "bash /home/devuser/mscclpp/tools/install.sh amd /usr"
}
