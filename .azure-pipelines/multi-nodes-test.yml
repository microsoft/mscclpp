trigger:
- main

# Do not run multi-nodes-test for PR, we can trigger it manually
pr: none

variables:
  hostName: "mscclit-vmss:50000"

jobs:
- job: MultiNodesTest-cuda11
  displayName: Multi nodes test cuda11
  pool:
    vmImage: ubuntu-latest
  container:
    image: ghcr.io/microsoft/mscclpp/mscclpp:base-dev-cuda11.8

  steps:
  - template: multi-nodes-steps-template.yml
    parameters:
      hostName: ${{ variables.hostName }}

- job: MultiNodesTest-cuda12
  displayName: Multi nodes test cuda12
  dependsOn: MultiNodesTest-cuda11 # Make sure the vmss not be used by multiple jobs
  pool:
    vmImage: ubuntu-latest
  container:
    image: ghcr.io/microsoft/mscclpp/mscclpp:base-dev-cuda12.2

  steps:
  - template: multi-nodes-steps-template.yml
    parameters:
      hostName: ${{ variables.hostName }}
